<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>波動鑑定 - 運命の数字があなたを導きます</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        .mystical-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .card-glow {
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        .number-btn {
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }
        .number-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
            background: rgba(255, 255, 255, 0.2);
        }
        .blur-text {
            filter: blur(3px);
            pointer-events: none;
            user-select: none;
        }
        .reading-container {
            max-height: 300px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .admin-panel {
            display: none;
            background: rgba(0, 0, 0, 0.95);
            color: white;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 600px;
            z-index: 1000;
            border-radius: 12px;
            padding: 30px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .search-box {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 120px;
        }
        .search-box input {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-size: 12px;
            padding: 5px 10px;
            border-radius: 20px;
            width: 100%;
        }
        .search-box input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
    </style>
</head>
<body class="mystical-bg">
    <!-- 検索ボックス -->
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="検索..." onkeypress="handleSearch(event)">
    </div>

    <div class="container mx-auto px-4 py-8">
        <!-- メインタイトル -->
        <div class="text-center mb-12">
            <h1 class="text-4xl md:text-6xl font-bold text-white mb-4">
                <i class="fas fa-star-of-david mr-4"></i>
                波動鑑定
                <i class="fas fa-star-of-david ml-4"></i>
            </h1>
            <p class="text-xl text-white opacity-90">あなたの番号を選んで、宇宙からのメッセージを受け取りましょう</p>
        </div>

        <!-- 番号選択 -->
        <div class="card-glow bg-white bg-opacity-20 rounded-3xl p-8 mb-8 max-w-4xl mx-auto">
            <h2 class="text-2xl font-bold text-white text-center mb-8">
                <i class="fas fa-magic mr-2"></i>
                あなたの運命の番号を選んでください
            </h2>
            
            <div class="grid grid-cols-4 gap-4 md:gap-6">
                <button class="number-btn rounded-2xl p-6 text-white text-2xl font-bold" onclick="selectNumber(1)">①</button>
                <button class="number-btn rounded-2xl p-6 text-white text-2xl font-bold" onclick="selectNumber(2)">②</button>
                <button class="number-btn rounded-2xl p-6 text-white text-2xl font-bold" onclick="selectNumber(3)">③</button>
                <button class="number-btn rounded-2xl p-6 text-white text-2xl font-bold" onclick="selectNumber(4)">④</button>
                <button class="number-btn rounded-2xl p-6 text-white text-2xl font-bold" onclick="selectNumber(5)">⑤</button>
                <button class="number-btn rounded-2xl p-6 text-white text-2xl font-bold" onclick="selectNumber(6)">⑥</button>
                <button class="number-btn rounded-2xl p-6 text-white text-2xl font-bold" onclick="selectNumber(7)">⑦</button>
                <button class="number-btn rounded-2xl p-6 text-white text-2xl font-bold" onclick="selectNumber(8)">⑧</button>
            </div>
        </div>

        <!-- 鑑定結果 -->
        <div id="resultSection" class="card-glow bg-white bg-opacity-95 rounded-3xl p-8 max-w-4xl mx-auto" style="display: none;">
            <h3 class="text-2xl font-bold text-purple-800 text-center mb-6">
                <i class="fas fa-crystal-ball mr-2"></i>
                番号<span id="selectedNumber"></span>の波動鑑定
            </h3>
            
            <div class="reading-container">
                <div id="readingText" class="text-gray-800 leading-relaxed"></div>
                <div id="blurredText" class="blur-text text-gray-800 leading-relaxed" style="display: none;"></div>
            </div>

            <div class="text-center mt-6">
                <p class="text-sm text-gray-600 mb-4">
                    <i class="fas fa-info-circle mr-1"></i>
                    LINE追加後、このページに戻ると全文表示されます
                </p>
                <a href="https://lin.ee/aYxAyTn" target="_blank" 
                   class="inline-block bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-full transition duration-300">
                    <i class="fab fa-line mr-2"></i>
                    さらに詳しく見る
                </a>
            </div>
        </div>
    </div>

    <!-- 管理者パネル -->
    <div id="adminPanel" class="admin-panel">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-bold">管理者パネル</h3>
            <button onclick="closeAdminPanel()" class="text-white hover:text-red-400">
                <i class="fas fa-times text-2xl"></i>
            </button>
        </div>

        <div class="space-y-6">
            <div>
                <label class="block text-sm font-medium mb-2">編集する番号:</label>
                <select id="editNumber" class="w-full p-3 bg-gray-800 text-white rounded border">
                    <option value="1">①</option>
                    <option value="2">②</option>
                    <option value="3">③</option>
                    <option value="4">④</option>
                    <option value="5">⑤</option>
                    <option value="6">⑥</option>
                    <option value="7">⑦</option>
                    <option value="8">⑧</option>
                </select>
            </div>

            <div>
                <label class="block text-sm font-medium mb-2">鑑定文章（前半部分 - 表示される部分）:</label>
                <textarea id="frontText" rows="5" class="w-full p-3 bg-gray-800 text-white rounded border"></textarea>
            </div>

            <div>
                <label class="block text-sm font-medium mb-2">鑑定文章（後半部分 - LINE追加後に表示される部分）:</label>
                <textarea id="backText" rows="5" class="w-full p-3 bg-gray-800 text-white rounded border"></textarea>
            </div>

            <div>
                <label class="block text-sm font-medium mb-2">Personal Access Token:</label>
                <input type="password" id="githubToken" class="w-full p-3 bg-gray-800 text-white rounded border" placeholder="ghp_...">
            </div>

            <div>
                <label class="block text-sm font-medium mb-2">LINE URL:</label>
                <input type="text" id="lineUrl" class="w-full p-3 bg-gray-800 text-white rounded border" value="https://lin.ee/aYxAyTn">
            </div>

            <div class="flex space-x-4">
                <button onclick="loadReading()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded">
                    <i class="fas fa-download mr-2"></i>読み込み
                </button>
                <button onclick="updateGithub()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded">
                    <i class="fas fa-upload mr-2"></i>GitHub更新
                </button>
            </div>

            <div id="updateStatus" class="mt-4 p-3 rounded" style="display: none;"></div>
        </div>
    </div>

    <script>
        // 鑑定データ
        let readingsData = {
            1: {
                front: "あなたの魂は創造性に満ち溢れています。新たな始まりの時期が近づいており、これまでとは違う道筋が見えてきます。",
                back: "宇宙はあなたに大きなチャンスを与えようとしています。恋愛面では運命的な出会いが、仕事面では昇進や転職の機会が訪れるでしょう。今月中に重要な決断を迫られる場面がありますが、直感を信じて進んでください。"
            },
            2: {
                front: "協調性とバランスがあなたのキーワードです。人間関係において調和を保つ力があなたにはあります。",
                back: "パートナーシップに関して大きな変化が訪れます。既にお相手がいる方は関係が深まり、独身の方は理想的な相手との出会いがあるでしょう。金運も上昇中で、投資や副業に関して良いニュースが舞い込みそうです。"
            },
            3: {
                front: "表現力と社交性に長けているあなた。周囲の人々があなたの魅力に引き寄せられています。",
                back: "クリエイティブな分野での才能が開花する時期です。趣味が仕事につながったり、新しい技能を身につけることで収入アップが期待できます。健康面では少し疲れが溜まっているようなので、適度な休息を心がけてください。"
            },
            4: {
                front: "安定と実行力があなたの強みです。着実に目標に向かって進む姿勢が周囲から評価されています。",
                back: "長期的な計画が実を結ぶ時期に入ります。不動産や貯蓄に関して良い機会が訪れるでしょう。家族との関係も深まり、特に年上の方からのサポートを受けられそうです。新しい学びや資格取得にも適した時期です。"
            },
            5: {
                front: "自由と変化を求めるあなたの心。新しい経験や冒険が運気を高める鍵となります。",
                back: "旅行や引越しなど、環境の変化が幸運を呼び込みます。遠方の人との縁が深まり、国際的な展開も期待できるでしょう。学習意欲が高まり、語学や専門スキルの習得が将来の成功につながります。"
            },
            6: {
                front: "愛情深く、責任感の強いあなた。家族や大切な人への思いが運気を上昇させています。",
                back: "家庭運が特に好調で、結婚や出産などおめでたい出来事が期待できます。仕事では人を指導したり、チームをまとめる役割が与えられそうです。美容や健康への投資が良い結果をもたらすでしょう。"
            },
            7: {
                front: "神秘的な洞察力と直感力に優れたあなた。スピリチュアルな感性が研ぎ澄まされています。",
                back: "隠された真実や新しい発見をする可能性が高まっています。研究や調査に関わることで大きな成果を上げられるでしょう。精神的な成長の時期でもあり、瞑想や自己啓発が開運のカギとなります。"
            },
            8: {
                front: "強いリーダーシップと成功への意欲を持つあなた。物質的な豊かさを引き寄せる力があります。",
                back: "ビジネスや投資において大きなチャンスが訪れます。昇進や独立の機会も期待でき、経済的な安定が手に入るでしょう。ただし、成功と共に責任も増すため、周囲への感謝を忘れずに進むことが重要です。"
            }
        };

        function selectNumber(num) {
            document.getElementById('selectedNumber').textContent = num;
            const reading = readingsData[num];
            
            document.getElementById('readingText').innerHTML = reading.front + '<br><br><span style="color: #888;">続きを読むには...</span>';
            document.getElementById('blurredText').textContent = reading.back;
            
            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
        }

        function handleSearch(event) {
            if (event.key === 'Enter') {
                const searchValue = event.target.value;
                if (searchValue === '1995') {
                    document.getElementById('adminPanel').style.display = 'block';
                    event.target.value = '';
                }
            }
        }

        function closeAdminPanel() {
            document.getElementById('adminPanel').style.display = 'none';
        }

        function loadReading() {
            const num = document.getElementById('editNumber').value;
            const reading = readingsData[num];
            document.getElementById('frontText').value = reading.front;
            document.getElementById('backText').value = reading.back;
        }

        function updateGithub() {
            const token = document.getElementById('githubToken').value;
            const num = document.getElementById('editNumber').value;
            const frontText = document.getElementById('frontText').value;
            const backText = document.getElementById('backText').value;
            const lineUrl = document.getElementById('lineUrl').value;
            
            if (!token) {
                showStatus('Personal Access Tokenを入力してください', 'error');
                return;
            }

            showStatus('更新中...', 'loading');

            // データを更新
            readingsData[num] = {
                front: frontText,
                back: backText
            };

            // GitHub APIで更新
            updateGithubFile(token, readingsData, lineUrl)
                .then(() => {
                    showStatus('GitHub更新完了!', 'success');
                    // トークンをクリア
                    document.getElementById('githubToken').value = '';
                })
                .catch(error => {
                    showStatus('エラー: ' + error.message, 'error');
                });
        }

        async function updateGithubFile(token, data, lineUrl) {
            const owner = 'spiritual999';
            const repo = 'hadou-999';
            const path = 'index.html';
            
            try {
                // 現在のファイル情報を取得
                const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                let sha = null;
                if (response.ok) {
                    const fileData = await response.json();
                    sha = fileData.sha;
                }

                // 新しいHTMLコンテンツを生成
                const newHtmlContent = generateHtmlContent(data, lineUrl);
                
                // Base64エンコード（日本語対応）
                const encodedContent = btoa(unescape(encodeURIComponent(newHtmlContent)));

                // ファイルを更新
                const updateData = {
                    message: 'Update spiritual reading content',
                    content: encodedContent,
                    branch: 'main'
                };

                if (sha) {
                    updateData.sha = sha;
                }

                const updateResponse = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updateData)
                });

                if (!updateResponse.ok) {
                    const errorData = await updateResponse.json();
                    throw new Error(errorData.message || 'GitHub更新に失敗しました');
                }

                return await updateResponse.json();
            } catch (error) {
                throw error;
            }
        }

        function generateHtmlContent(data, lineUrl) {
            // 現在のHTMLコンテンツを取得し、readingsDataを更新
            let htmlContent = document.documentElement.outerHTML;
            
            // readingsData部分を新しいデータで置換
            const dataString = JSON.stringify(data, null, 12);
            const dataRegex = /let readingsData = \{[\s\S]*?\};/;
            const newDataString = `let readingsData = ${dataString};`;
            
            htmlContent = htmlContent.replace(dataRegex, newDataString);
            
            // LINE URLを更新
            if (lineUrl) {
                htmlContent = htmlContent.replace(/https:\/\/lin\.ee\/\w+/g, lineUrl);
            }
            
            return htmlContent;
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('updateStatus');
            statusDiv.style.display = 'block';
            statusDiv.textContent = message;
            
            statusDiv.className = 'mt-4 p-3 rounded ';
            
            switch(type) {
                case 'success':
                    statusDiv.className += 'bg-green-600 text-white';
                    break;
                case 'error':
                    statusDiv.className += 'bg-red-600 text-white';
                    break;
                case 'loading':
                    statusDiv.className += 'bg-blue-600 text-white';
                    break;
                default:
                    statusDiv.className += 'bg-gray-600 text-white';
            }
        }

        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            // 管理者パネルの外側クリックで閉じる
            document.addEventListener('click', function(event) {
                const adminPanel = document.getElementById('adminPanel');
                if (event.target === adminPanel) {
                    closeAdminPanel();
                }
            });
        });
    </script>
</body>
</html>
